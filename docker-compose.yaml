version: '3'
services:
#         homeassistant:
#                 container_name: home-assistant
#                 image: homeassistant/home-assistant
#                 volumes:
#                         - ./homeassistant:/config
#                         - /etc/localtime:/etc/localtime:ro
#                 restart: always
#                 network_mode: host
        hassio:
                image: homeassistant/amd64-hassio-supervisor
                container_name: hassio_supervisor
                privileged: true
                entrypoint: ["/bin/bash", "-c", "/scripts/start_hassio.sh"]
                security_opt:
                  - seccomp:unconfined
                environment:
                  - HOMEASSISTANT_REPOSITORY=homeassistant/qemux86-64-homeassistant
                  - SUPERVISOR_SHARE=${SUPERVISOR_SHARE}
                  - SUPERVISOR_NAME=hassio_supervisor
                  - DBUS_SYSTEM_BUS_ADDRESS=unix:path=/var/run/dbus/system_bus_socket
                volumes:
                  - ${SUPERVISOR_SHARE}:/data
                  - ./hassio_scripts:/scripts
                  - /var/run/docker.sock:/var/run/docker.sock
                  - /var/run/dbus/system_bus_socket:/var/run/dbus/system_bus_socket
        
        mosquitto:
                image: eclipse-mosquitto
                container_name: mosquitto
                ports:
                        - 1883:1883
                        - 9001:9001
                volumes:
                        - ./mosquitto/:/mosquitto/config/
                restart: always
        motioneye:
                image: ccrisan/motioneye:master-amd64
                container_name: motioneye
                volumes:
                        - /etc/localtime:/etc/localtime:ro
                        - ./motioneye/etc:/etc/motioneye
                        - ./motioneye/lib:/var/lib/motioneye
                devices:
                        - "/dev/video1:/dev/video1"
                        - "/dev/video2:/dev/video2"
                restart: always
                network_mode: host
        puller:
                image: eliseomartelli/puller
                container_name: puller
                restart: always
                volumes:
                        - ./:/config
        assistant_relay:
                image: eliseomartelli/assistant-relay-docker
                container_name: assistantrelay
                restart: always
                ports:
                        - 3000:3000
        ha_dockermon:
                image: philhawthorne/ha-dockermon
                container_name: ha_dockermon
                restart: always
                volumes:
                        - /var/run/docker.sock:/var/run/docker.sock
                        - ./ha_dockermon:/config
        duckdns:
                image: linuxserver/duckdns
                container_name: duckdns
                environment:
                        - TZ=Europe/Rome
                        - SUBDOMAINS=${SUBDOMAIN}
                        - TOKEN=${TOKEN}
                restart: always
        caddy:
                image: abiosoft/caddy
                container_name: caddy
                volumes:
                        - ./caddy/certs/:/etc/caddycerts/
                        - ./caddy/Caddyfile:/etc/Caddyfile
                ports:
                        - 80:80
                        - 443:443
                        - 2015:2015
                environment:
                        - CADDYPATH=/etc/caddycerts/
                        - ACME_AGREE=true
                        - DOMAIN=${DOMAIN}
                restart: always
                networks:
                        - default
                        - hassio

networks:
        hassio:
                external:
                        name: hassio
